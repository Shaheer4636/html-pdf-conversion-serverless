FROM public.ecr.aws/lambda/python:3.12

# Native runtime deps for WeasyPrint (Pango, Cairo, GDK-PixBuf, fonts)
# AL2023 uses dnf (yum isnâ€™t present).
RUN dnf -y install \
      pango \
      cairo \
      cairo-gobject \
      gdk-pixbuf2 \
      gdk-pixbuf2-modules \
      libjpeg-turbo \
      libpng \
      freetype \
      fontconfig \
      harfbuzz \
      fribidi \
      libxml2 \
      libxslt \
      libffi \
  && dnf clean all

# Vendor exact compatible wheels into /var/task/vendor
RUN pip install --no-cache-dir -t /var/task/vendor \
      weasyprint==61.2 \
      pydyf==0.11.0 \
      tinycss2==1.3.0 \
      cssselect2==0.7.0 \
      html5lib==1.1 \
      fonttools==4.53.0 \
      Pillow==10.3.0 \
      Pyphen==0.17.2 \
      cffi==2.0.0

# Your handler
COPY lambda_function.py /var/task/

# Lambda entrypoint
CMD ["lambda_function.lambda_handler"]

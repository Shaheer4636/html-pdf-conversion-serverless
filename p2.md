   Computer script on a screen                                                                                                                                                                                                  

How to create new IAC pipeline from IAC_master_code: 

 

Prologue: 

Just to set a context IAC-master-code pipeline is this main code where we test the creation of our IAC modules as well as used as a template for implementing new IAC project pipelines. 

Necessary to read: IAC Process Overview - Overview (visualstudio.com). 

 

Steps to create: 
 

Create a repository on ADO (Azure DevOps) under (only Ari can do this- so you should state what needs done to request this. https://samcado.visualstudio.com/DEVOPS_Platform_as_a_Service. 

Clone repo:  
git clone https://samcado.visualstudio.com/DEVOPS_Platform_as_a_Service/_git/IAC-master-code 

Clone the repo in question under ADO Projects: https://samcado.visualstudio.com/DEVOPS_Platform_as_a_Service/_git/{{NEW_PROJECT}} 

Copy the following files (minimal modules, to create a VPC):  

vars/codedev.tfvars 

azure_pipeline.yml 

destroy_pipeline.yaml 

IAC_checkout.yaml 

locals.tf 

variables.tf 

variables_vpc.tf 

vpc.tf 

Start the cleanup of the copy: 

Name of the environment (environment: “${{ENV}}” in azure-pipeline.yml and destroy-pipeline.yml is the same as the name of the tfvars file example vars/${{ENV}}.tfvars. 

Here you can see all vars configured for a minimum of vpc and module ssrs-rdsmssql implementation: Z_Leo_IAC_pipeline - Repos (visualstudio.com) 

Check here the changes to pass from vpc module build, the minimal to pass to a more complicated ssrs-rdsmssql module. This has dependencies on alarm-aggregator module and iam-control module: on this commit: Commit 542b2d0d: FinalTest#1 - Repos (visualstudio.com) 

 

All pipelines require access to project resources like service connections or pipeline secure files. After the first run of the pipeline, you will see something like below. (Ask Platform team to grant necessary approval if you cannot):Note: May differ according to the pipeline. 

Important as Deploy is the destroy pipeline, and is good to define both: 

resources: 
			repositories: 
Ensure all modules and refs are the same in azure-pipeline.yml and destroy-pipeline.yml. 

Refer to the above repository and branch. 

Should you mention anything about the variable's files? 

Create a pipeline: 
 

Go to pipelines: Pipelines - Recent (visualstudio.com): click blue button new pipeline: 
 

Will take you to here: 
Click on Azure Repos Git. 

Then pick your pipeline repository, where your azure-pipeline.yml and destroy-pipeline.yml are. 
 

Something like this will be shown:pick existing pipeline. 

Then you will see another screen to allow you to select which pipeline you need: 
 

Then you will see the pipeline code, click run, if everything is good will start running: 
 

By default, the pipeline will be named with the name of the yml file, example azure-pipeline.yml, so you need to go to the pipeline in question: 
After clicking you will see the delete/rename click it and rename it. 
 

NOTE: The STANDARD below needs review.  Most deploy pipelines are named like <product name-pipeline> and the destroy is <DESTROY-product name-pipeline> 
	DEPLOY_repo 
 	DESTROY_repo 
Capitalize to define actions. 

 

Feel free to leave comments and let me know how this text can be improved. 
 
